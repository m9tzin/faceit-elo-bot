name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  code-quality:
    name: ðŸ“Š Code Quality Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Busca todo histÃ³rico para anÃ¡lise completa
      
      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
      
      - name: ðŸ“¦ Install dependencies
        run: npm ci
      
      - name: ðŸ” Check for console.log statements
        run: |
          echo "Looking for console.log statements in source code..."
          if grep -r "console\.log" src/ --exclude-dir=node_modules --exclude-dir=.git; then
            echo ""
            echo "âš ï¸ Warning: console.log statements found in code"
            echo "ðŸ’¡ Consider using a proper logging library for production"
          else
            echo "âœ… No console.log statements found"
          fi
        continue-on-error: true
      
      - name: ðŸ“ Check file sizes
        run: |
          echo ""
          echo "ðŸ“Š Top 10 largest JavaScript files:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          find src -type f -name "*.js" -exec wc -l {} + | sort -rn | head -10
          echo ""
          echo "ðŸ’¡ Files with 300+ lines might need refactoring"
      
      - name: ðŸ“ˆ Code Statistics
        run: |
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘        CODE STATISTICS                â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ“ Total JS files: $(find src -name '*.js' | wc -l)"
          echo "ðŸ“ Total lines of code: $(find src -name '*.js' -exec cat {} + | wc -l)"
          echo "ðŸ“Š Average lines per file: $(echo "scale=0; $(find src -name '*.js' -exec cat {} + | wc -l) / $(find src -name '*.js' | wc -l)" | bc)"
          echo ""
          echo "ðŸ“¦ Dependencies:"
          echo "  - Production: $(node -e "console.log(Object.keys(require('./package.json').dependencies || {}).length)")"
          echo "  - Development: $(node -e "console.log(Object.keys(require('./package.json').devDependencies || {}).length)")"
          echo ""
      
      - name: ðŸ“ Find TODO comments
        run: |
          echo "ðŸ” Searching for TODO/FIXME comments..."
          if grep -rn "TODO\|FIXME" src/ --exclude-dir=node_modules --exclude-dir=.git; then
            echo ""
            echo "ðŸ“ TODO/FIXME comments found above"
          else
            echo "âœ… No TODO/FIXME comments found"
          fi
        continue-on-error: true
      
      - name: ðŸ“¦ Check dependencies size
        run: |
          echo ""
          echo "ðŸ“¦ Dependency installation size:"
          du -sh node_modules 2>/dev/null || echo "node_modules not found"
          echo ""
          echo "ðŸ’¡ Smaller dependencies = faster deployments"

